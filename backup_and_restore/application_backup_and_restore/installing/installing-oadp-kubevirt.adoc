:_mod-docs-content-type: ASSEMBLY
[id="installing-oadp-kubevirt"]
// If docs team approves the name, "Configuring OADP with Kubevirt" great but I suspect it will need to be "Configuring OADP with OpenShift Virtualization" or "Configuring OADP with Virtualization" or perhaps... bear with me.. "OADP and OpenShift-Virtualization"
= Configuring the OpenShift API for Data Protection with {VirtProductName}
include::_attributes/common-attributes.adoc[]
:context: installing-oadp-kubevirt
:installing-oadp-kubevirt:
:credentials: cloud-credentials
:provider: kubevirt

toc::[]

You install the {oadp-first} with {VirtProductName} by installing the OADP Operator and configuring a backup location and a snapshot location. Then, you install the Data Protection Application.

// include::snippets/oadp-mtc-operator.adoc[]

Back up and restore virtual machines by using the xref:../../../backup_and_restore/index.adoc#application-backup-restore-operations-overview[OpenShift API for Data Protection (OADP)].

.Prerequisites

* Access to the cluster as a user with the `cluster-admin` role.

.Procedure

. Install the xref:../../../backup_and_restore/application_backup_and_restore/installing/about-installing-oadp.adoc#about-installing-oadp[OADP Operator] according to the instructions for your storage provider.

. Install the xref:oadp-installing-dpa-1-3_installing-oadp-kubevirt[Data Protection Application] with the `kubevirt` and `openshift` xref:../../../backup_and_restore/application_backup_and_restore/oadp-features-plugins.adoc#oadp-plugins_oadp-features-plugins[plugins].

. Back up virtual machines by creating a xref:../../../backup_and_restore/application_backup_and_restore/backing_up_and_restoring/backing-up-applications.adoc#backing-up-applications[`Backup` custom resource (CR)].

. Restore the `Backup` CR by creating a xref:../../../backup_and_restore/application_backup_and_restore/backing_up_and_restoring/restoring-applications.adoc#restoring-applications[`Restore` CR].

You create a `Secret` for the backup location and then you install the Data Protection Application. For more details, see xref:../../..//backup_and_restore/application_backup_and_restore/installing/oadp-installing-operator.adoc#oadp-installing-operator-doc[Installing the OADP Operator].

To install the OADP Operator in a restricted network environment, you must first disable the default OperatorHub sources and mirror the Operator catalog. For details, see xref:../../../operators/admin/olm-restricted-networks.adoc#olm-restricted-networks[Using Operator Lifecycle Manager on restricted networks].


//include::modules/oadp-installing-operator.adoc[leveloffset=+1]
include::modules/oadp-about-backup-snapshot-locations-secrets.adoc[leveloffset=+1]

include::modules/oadp-creating-default-secret.adoc[leveloffset=+2]

include::modules/oadp-secrets-for-different-credentials.adoc[leveloffset=+2]

[id="configuring-dpa-kubevirt"]
== Configuring the Data Protection Application

You can configure the Data Protection Application by setting Velero resource allocations or enabling self-signed CA certificates.

// include::modules/oadp-kubevirt-setting-resource-limits-and-requests.adoc[leveloffset=+2]

include::modules/oadp-self-signed-certificate.adoc[leveloffset=+2]

include::modules/oadp-installing-dpa-1-3.adoc[leveloffset=+1]

[IMPORTANT]
.OADP 1.2
====
// While it is possible to use OADP 1.2, it is advisable to use OADP 1.3. W.H: "We want stronger language here, and perhaps put this at the top of the section as well.  "Red Hat supports the combination of OADP-1.3.x and OpenShift-Virtualization 4.14+ only"  Using OADP-1.2.x to backup and restore OpenShift-Virtualization will not be supported"
Red Hat only supports the combination of OADP versions 1.3.0 and later, and {VirtProductName} versions 4.14 and later.
OADP versions before 1.3.0 are not supported for back up and restore of {VirtProductName}.
====

// include::modules/oadp-creating-object-bucket-claim.adoc[leveloffset=+2]

// include::modules/oadp-enabling-csi-dpa.adoc[leveloffset=+2] -- If possible IMHO we could remove this section from the kubevirt section if possible, if it's a PITA don't sweat it installing-oadp-kubevirt#oadp-enabling-csi-dpa_installing-oadp-kubevirt

:!installing-oadp-kubevirt:
